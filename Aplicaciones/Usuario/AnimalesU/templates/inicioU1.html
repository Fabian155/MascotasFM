{% extends "plantillaU.html" %}
{% load static %}
{% block contenido %}

<h2 class="mb-3">Mascotas disponibles</h2>

{% if not tiene_perfil_adoptante %}
  <div class="alert alert-warning d-flex justify-content-between align-items-center">
    <div>
       Antes de adoptar, por favor completa tu
      <a href="{% url 'nuevoAdoptado' %}"><strong>registro de adoptante</strong></a>.
    </div>
    <a href="{% url 'nuevoAdoptado' %}" class="btn btn-outline-warning btn-sm">Completar registro</a>
  </div>
{% endif %}

<table class="table table-bordered table-striped table-hover" id="tbl_animales_u">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Especie</th>
      <th>Edad</th>
      <th>Salud</th>
      <th>Foto</th>
      <th>Ficha PDF</th>
      <th>Precio</th>
      <th>Estado</th>
      <th>Acción</th>
    </tr>
  </thead>
  <tbody>
    {% for a in animales %}
      <tr>
        <td>{{ a.id }}</td>
        <td>{{ a.nombre }}</td>
        <td>{{ a.especieid }}</td>
        <td>{{ a.edad }}</td>
        <td>{{ a.salud }}</td>

        <td>
          {% if a.logo %}
            <img src="{{ a.logo.url }}" alt="{{ a.nombre }}" style="height:70px;">
          {% else %}
            <span class="text-muted">Sin imagen</span>
          {% endif %}
        </td>

        <td>
          {% if a.pdf %}
            <a href="{{ a.pdf.url }}" target="_blank">Ver PDF</a>
          {% else %}
            <span class="text-muted">No disponible</span>
          {% endif %}
        </td>
        <td>{{a.precio|floatformat:2 }}</td>
          <td>
            {% if a.estado == "DISPONIBLE" %}
            <span class="badge bg-success">DISPONIBLE</span>
            {% elif a.estado == "ADOPTADO" %}
            <span class="badge bg-secondary">ADOPTADO</span>
            {% else %}
            <span class="badge bg-light text-dark">{{ a.estado }}</span>
            {% endif %}
          </td>

        <td>
            <a href="{% url 'adopcionu:inicioG' a.id %}" class="btn btn-primary btn-sm">
                Solicitar adopción
            </a>
        </td>

      </tr>
    {% empty %}
      <tr>
        <td colspan="8" class="text-center text-muted">No hay mascotas registradas.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    $('#tbl_animales_u').DataTable({
      dom: 'Bfrtip',
      buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
      language: { url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json' }
    });
  });
</script>

{% if messages %}
  {% for message in messages %}
    <script>
      Swal.fire({ title: "Mensaje", text: "{{ message }}", icon: "success" });
    </script>
  {% endfor %}
{% endif %}

{% endblock %}
