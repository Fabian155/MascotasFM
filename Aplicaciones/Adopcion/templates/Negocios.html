{% extends "plantilla.html" %}
{% load static %}
{% block contenido %}
<div class="container mt-4">
  <h2 class="mb-4">ðŸ“Š Panel de Negocios - Inteligencia de Adopciones</h2>

  <div class="row text-center">
    <div class="col-md-4">
      <div class="card shadow-sm p-3">
        <h5>Total de Adopciones</h5>
        <h3 class="text-primary">{{ total_adopciones }}</h3>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm p-3">
        <h5>Total Recaudado</h5>
        <h3 class="text-success">${{ total_recaudado|floatformat:2 }}</h3>
      </div>
    </div>
  </div>

  <hr class="my-4">

  <div class="row">
    <div class="col-md-6">
      <h5> Adopciones por Mes</h5>
      <canvas id="chartAdopcionesMes"></canvas>
    </div>
    <div class="col-md-6">
      <h5> Estado de las Mascotas</h5>
      <canvas id="chartEstadoAnimales"></canvas>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- SecciÃ³n para pasar los datos de Django a JavaScript -->
{{ adopciones_por_mes|json_script:"adopciones-data" }}
{{ estado_animales|json_script:"estado-data" }}

<script>
  
  const adopcionesPorMes = JSON.parse(document.getElementById('adopciones-data').textContent);
  const estadoAnimales = JSON.parse(document.getElementById('estado-data').textContent);

  
  const ctx1 = document.getElementById('chartAdopcionesMes').getContext('2d');
  const meses = adopcionesPorMes.map(item => item.fecha);
  const totales = adopcionesPorMes.map(item => item.total);

  new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: meses,
      datasets: [{
        label: 'Cantidad de Adopciones',
        data: totales,
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'NÃºmero de Adopciones' }
        },
        x: { title: { display: true, text: 'Fecha' } }
      }
    }
  });

  
  const ctx2 = document.getElementById('chartEstadoAnimales').getContext('2d');
  const labels2 = estadoAnimales.map(item => item.estado);
  const values2 = estadoAnimales.map(item => item.total);

  new Chart(ctx2, {
    type: 'doughnut',
    data: {
      labels: labels2,
      datasets: [{
        data: values2,
        backgroundColor: ['#4CAF50', '#FFC107', '#9E9E9E', '#2196F3'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' },
        title: { display: false }
      }
    }
  });
</script>
{% endblock %}
