{% extends "plantilla.html" %}
{% load static %}
{% block contenido %}
<div class="container mt-4">
  <h2 class="mb-4">ğŸ“Š Panel de Negocios - Inteligencia de Adopciones</h2>

  <div class="row text-center">
    <div class="col-md-4">
      <div class="card shadow-sm p-3">
        <h5>Total de Adopciones</h5>
        <h3 class="text-primary">{{ total_adopciones }}</h3>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm p-3">
        <h5>Total Recaudado</h5>
        <h3 class="text-success">${{ total_recaudado }}</h3>
      </div>
    </div>
  </div>

  <hr class="my-4">

  <div class="row">
    <div class="col-md-6">
      <h5>ğŸ¾ Adopciones por Mes</h5>
      <canvas id="chartAdopcionesMes"></canvas>
    </div>
    <div class="col-md-6">
      <h5>ğŸ“¦ Estado de las Mascotas</h5>
      <canvas id="chartEstadoAnimales"></canvas>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Datos desde Django
  const adopcionesPorMes = JSON.parse('{{ adopciones_por_mes|safe|escapejs }}');
  const estadoAnimales = JSON.parse('{{ estado_animales|safe|escapejs }}');

  // GrÃ¡fica 1 - Adopciones por mes
  const ctx1 = document.getElementById('chartAdopcionesMes').getContext('2d');
  const meses = adopcionesPorMes.map(item => item.fecha);
  const totales = adopcionesPorMes.map(item => item.total);
  new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: meses,
      datasets: [{
        label: 'Adopciones',
        data: totales,
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: { scales: { y: { beginAtZero: true } } }
  });

  const ctx2 = document.getElementById('chartEstadoAnimales').getContext('2d');
  const labels2 = estadoAnimales.map(item => item.estado);
  const values2 = estadoAnimales.map(item => item.total);
  new Chart(ctx2, {
    type: 'doughnut',
    data: {
      labels: labels2,
      datasets: [{
        data: values2,
        backgroundColor: ['#4CAF50', '#9E9E9E'],
      }]
    },
    options: { responsive: true }
  });
</script>
{% endblock %}
